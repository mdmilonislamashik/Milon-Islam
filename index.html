<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Pro Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        .product-card:hover { transform: translateY(-5px); transition: 0.3s; }
        .cart-item { border-bottom: 1px solid #eee; padding: 8px 0; }
        input, select { border: 1px solid #ddd !important; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 transition-colors duration-300">

<nav class="bg-white shadow-md p-4 sticky top-0 z-50 flex justify-between items-center">
    <h1 class="text-xl font-bold text-blue-600">My Pro Shop</h1>
    <button onclick="toggleDark()" id="themeBtn" class="bg-gray-200 px-4 py-2 rounded-full text-sm">üåô Dark</button>
</nav>

<div class="max-w-6xl mx-auto p-4">
    <h2 class="text-2xl font-bold mb-6 border-b-2 border-blue-500 inline-block">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡¶£‡ßç‡¶Ø‡¶∏‡¶Æ‡ßÇ‡¶π</h2>
    <div id="products" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-10">
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-bold mb-4 flex items-center">üõí ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü</h2>
            <div id="cartItems" class="min-h-[100px]"></div>
            
            <div class="mt-4 pt-4 border-t">
                <div class="flex gap-2 mb-3">
                    <input id="couponInput" placeholder="ULM007" class="border p-2 rounded w-full focus:outline-blue-500">
                    <button onclick="applyCoupon()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Apply</button>
                </div>
                <div class="flex justify-between text-lg font-bold">
                    <span>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤:</span>
                    <span><span id="totalPrice">0</span> ‡¶ü‡¶æ‡¶ï‡¶æ</span>
                </div>
            </div>
        </div>

        <div class="bg-white p-6 rounded-xl shadow-lg border-t-4 border-green-500">
            <h2 class="text-xl font-bold mb-4">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
            <div class="space-y-3">
                <input id="name" type="text" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full p-3 rounded outline-none focus:ring-2 ring-green-200">
                <input id="phone" type="number" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞" class="w-full p-3 rounded outline-none focus:ring-2 ring-green-200">
                <select id="paymentMethod" class="w-full p-3 rounded outline-none bg-white">
                    <option value="">‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                    <option value="Bkash">Bkash (Personal)</option>
                    <option value="Nagad">Nagad (Personal)</option>
                    <option value="COD">Cash on Delivery</option>
                </select>
                <input id="trxid" type="text" placeholder="TrxID (‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¶‡¶ø‡¶®)" class="w-full p-3 rounded outline-none">
                <button onclick="placeOrder()" class="w-full bg-green-600 text-white py-3 rounded-lg font-bold text-lg hover:bg-green-700 transition">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>
    </div>

    <div class="mt-20 border-t pt-10">
        <div id="loginBox" class="max-w-sm mx-auto bg-white p-6 rounded shadow">
            <input id="adminPass" type="password" placeholder="Admin Password" class="w-full border p-2 mb-2 rounded outline-none">
            <button onclick="loginAdmin()" class="w-full bg-red-500 text-white py-2 rounded hover:bg-red-600">Admin Login</button>
        </div>

        <div id="adminPanel" class="hidden max-w-lg mx-auto bg-gray-800 text-white p-6 rounded shadow-xl">
            <h2 class="text-xl font-bold mb-4">Admin Control</h2>
            <div class="space-y-3 text-black">
                <input id="adminWhatsapp" placeholder="WhatsApp (e.g. 88017...)" class="w-full p-2 rounded outline-none">
                <input id="couponCode" placeholder="Promo Code" class="w-full p-2 rounded outline-none">
                <input id="couponDiscount" type="number" placeholder="Discount %" class="w-full p-2 rounded outline-none">
                <button onclick="saveAdmin()" class="w-full bg-blue-500 text-white py-2 rounded font-bold hover:bg-blue-600">Save Settings</button>
            </div>
        </div>
    </div>
</div>

<div id="successPopup" class="hidden fixed inset-0 bg-black/60 flex items-center justify-center z-[100] px-4">
    <div class="bg-white p-8 rounded-2xl max-w-sm w-full text-center shadow-2xl border-t-8 border-green-500">
        <div class="text-5xl mb-4">‚úÖ</div>
        <h2 class="text-2xl font-bold text-green-600 mb-2">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤!</h2>
        <p class="text-gray-600">‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶ü‡¶ø ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§</p>
        <button onclick="closePopup()" class="mt-6 bg-gray-800 text-white px-8 py-2 rounded-full hover:bg-black transition">‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá</button>
    </div>
</div>

<script>
/* ================= CONFIGURATION ================= */
const firebaseConfig = {
    apiKey: "AIzaSyAvAtKT_1p9n2u7fZogXjhq-gatKv79Vmw",
    authDomain: "ulm-shop.firebaseapp.com",
    projectId: "ulm-shop",
    storageBucket: "ulm-shop.firebasestorage.app",
    messagingSenderId: "582860639655",
    appId: "1:582860639655:web:dd4de2e143c762ba7f3a82"
};

// Firebase Initialize
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const products = [
    {id:1, name:"Premium T-Shirt", price:550, img:"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?auto=format&fit=crop&w=300"},
    {id:2, name:"Wireless Headphone", price:1200, img:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=300"},
    {id:3, name:"Smart Watch", price:2500, img:"https://images.unsplash.com/photo-1523275335684-37898b6baf30?auto=format&fit=crop&w=300"}
];

/* ================= APP STATE ================= */
let cart = JSON.parse(localStorage.getItem('myCart')) || [];
let admin = JSON.parse(localStorage.getItem('adminSettings')) || {whatsapp:"8801975805326", coupon:"ULM007", discountPercent:10};
let appliedDiscount = 0;

/* ================= CORE FUNCTIONS ================= */

function renderProducts() {
    const pDiv = document.getElementById("products");
    pDiv.innerHTML = products.map(p => `
        <div class="bg-white rounded-xl shadow product-card overflow-hidden border border-gray-100">
            <img src="${p.img}" class="h-48 w-full object-cover">
            <div class="p-4">
                <h3 class="font-bold text-lg">${p.name}</h3>
                <p class="text-blue-600 font-bold">${p.price} ‡¶ü‡¶æ‡¶ï‡¶æ</p>
                <button onclick="addToCart(${p.id})" class="w-full mt-3 bg-blue-600 text-white py-2 rounded hover:bg-blue-700 transition">Add to Cart</button>
            </div>
        </div>
    `).join('');
}

function addToCart(id) {
    const product = products.find(p => p.id === id);
    const existing = cart.find(item => item.id === id);
    if(existing) {
        existing.qty += 1;
    } else {
        cart.push({...product, qty: 1});
    }
    updateCart();
}

function updateCart() {
    localStorage.setItem('myCart', JSON.stringify(cart));
    const cartDiv = document.getElementById("cartItems");
    
    if(cart.length === 0) {
        cartDiv.innerHTML = `<p class="text-gray-400 text-center py-4">‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶Ü‡¶õ‡ßá...</p>`;
        document.getElementById("totalPrice").innerText = "0";
        return;
    }

    let subtotal = 0;
    cartDiv.innerHTML = cart.map((item, index) => {
        subtotal += (item.price * item.qty);
        return `
            <div class="cart-item flex justify-between items-center px-2">
                <div>
                    <p class="font-semibold text-gray-700">${item.name} x ${item.qty}</p>
                    <p class="text-sm text-blue-500">${item.price * item.qty} ‡¶ü‡¶æ‡¶ï‡¶æ</p>
                </div>
                <button onclick="removeItem(${index})" class="text-red-500 hover:bg-red-50 p-2 rounded-full">‚úñ</button>
            </div>
        `;
    }).join('');

    let finalTotal = subtotal - appliedDiscount;
    document.getElementById("totalPrice").innerText = finalTotal > 0 ? finalTotal : 0;
}

function removeItem(index) {
    cart.splice(index, 1);
    updateCart();
}

function applyCoupon() {
    const code = document.getElementById("couponInput").value.trim();
    if(code === admin.coupon) {
        let subtotal = cart.reduce((acc, curr) => acc + (curr.price * curr.qty), 0);
        appliedDiscount = Math.round((subtotal * admin.discountPercent) / 100);
        alert(`‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶ø ${admin.discountPercent}% ‡¶°‡¶ø‡¶∏‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶™‡ßá‡ßü‡ßá‡¶õ‡ßá‡¶®‡•§`);
        updateCart();
    } else {
        alert("‡¶≠‡ßÅ‡¶≤ ‡¶ï‡ßÅ‡¶™‡¶® ‡¶ï‡ßã‡¶°!");
    }
}

/* ================= ORDER SUBMISSION (FIXED) ================= */

async function placeOrder() {
    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const payment = document.getElementById("paymentMethod").value;
    const trxid = document.getElementById("trxid").value.trim() || "N/A";
    const total = document.getElementById("totalPrice").innerText;

    // Validation
    if(!name || !phone || cart.length === 0 || !payment) {
        alert("‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ, ‡¶´‡ßã‡¶®, ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßá‡¶•‡¶° ‡¶è‡¶¨‡¶Ç ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        return;
    }

    const orderData = {
        customer: name,
        phone: phone,
        items: cart.map(i => `${i.name}(${i.qty})`).join(', '),
        total: total,
        payment: payment,
        trxid: trxid,
        date: new Date().toLocaleString()
    };

    try {
        // 1. WhatsApp-‡¶è ‡¶Ü‡¶ó‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶® (‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ø‡ßá‡¶® ‡¶Æ‡¶ø‡¶∏ ‡¶®‡¶æ ‡¶π‡ßü)
        const text = `üì¶ *‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞*\n\nüë§ ‡¶®‡¶æ‡¶Æ: ${orderData.customer}\nüìû ‡¶´‡ßã‡¶®: ${orderData.phone}\nüõí ‡¶™‡¶£‡ßç‡¶Ø: ${orderData.items}\nüí∞ ‡¶Æ‡ßã‡¶ü: ${orderData.total} ‡¶ü‡¶æ‡¶ï‡¶æ\nüí≥ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü: ${orderData.payment}\nüÜî TrxID: ${orderData.trxid}\nüìÖ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${orderData.date}`;
        window.open(`https://wa.me/${admin.whatsapp}?text=${encodeURIComponent(text)}`);

        // 2. Firebase Database-‡¶è ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
        await db.collection("orders").add(orderData);

        // 3. ‡¶∏‡¶´‡¶≤ ‡¶π‡¶≤‡ßá ‡¶ï‡¶æ‡¶∞‡ßç‡¶ü ‡¶ñ‡¶æ‡¶≤‡¶ø ‡¶ï‡¶∞‡¶æ
        cart = [];
        appliedDiscount = 0;
        localStorage.removeItem('myCart');
        updateCart();
        
        // Success Popup
        document.getElementById("successPopup").classList.remove("hidden");
        
    } catch (error) {
        console.error("Error:", error);
        alert("‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ! ‡¶§‡¶¨‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞‡¶ü‡¶ø ‡¶π‡ßã‡ßü‡¶æ‡¶ü‡¶∏‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
    }
}

/* ================= ADMIN LOGIC ================= */

function loginAdmin() {
    if(document.getElementById("adminPass").value === "1234") {
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("adminPanel").classList.remove("hidden");
        // Load admin values
        document.getElementById("adminWhatsapp").value = admin.whatsapp;
        document.getElementById("couponCode").value = admin.coupon;
        document.getElementById("couponDiscount").value = admin.discountPercent;
    } else {
        alert("‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!");
    }
}

function saveAdmin() {
    admin = {
        whatsapp: document.getElementById("adminWhatsapp").value.trim(),
        coupon: document.getElementById("couponCode").value.trim(),
        discountPercent: Number(document.getElementById("couponDiscount").value)
    };
    localStorage.setItem('adminSettings', JSON.stringify(admin));
    alert("‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
}

function toggleDark() {
    document.body.classList.toggle("bg-gray-900");
    document.body.classList.toggle("text-white");
    const isDark = document.body.classList.contains("bg-gray-900");
    document.getElementById("themeBtn").innerText = isDark ? "‚òÄÔ∏è Light" : "üåô Dark";
}

function closePopup() { document.getElementById("successPopup").classList.add("hidden"); }

// Initialize Page
renderProducts();
updateCart();
</script>

</body>
</html>